<!DOCTYPE html>
<html lang="en" class="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read and Sort - Fortran Programs</title>
<meta name="description" content="Read and Sort - Fortran program by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta name="keywords" content="Kirill Arkhipenko, Кирилл Архипенко, kusaku, retrewert, aks1983, legacy">
<meta name="author" content="Kirill Arkhipenko">
<link rel="canonical" href="https://kusaku.su/legacy/fortran/readnsort.html">
<link rel="alternate" hreflang="en" href="https://kusaku.su/legacy/fortran/readnsort.html">
<link rel="alternate" hreflang="ru" href="https://kusaku.su/legacy/fortran/readnsort.html">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Read and Sort - Fortran Programs">
<meta property="og:description" content="Read and Sort - Fortran program by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta property="og:url" content="https://kusaku.su/legacy/fortran/readnsort.html">
<meta property="og:type" content="website">
<meta property="og:site_name" content="kusaku.su">
<meta property="og:image" content="https://kusaku.su/avatar.webp">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Read and Sort - Fortran Programs">
<meta name="twitter:description" content="Read and Sort - Fortran program by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta name="twitter:image" content="https://kusaku.su/avatar.webp">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/fortran.min.js"></script>
<style>
        html.light body { background: #ffffff; color: #24292f; }
        html.dark body { background: #0d1117; color: #c9d1d9; }
        html.light .bg-white { background-color: #ffffff; }
        html.dark .bg-white { background-color: #161b22; }
        html.light .text-gray-600 { color: #57606a; }
        html.dark .text-gray-600 { color: #8b949e; }
        html.light .text-gray-700 { color: #24292f; }
        html.dark .text-gray-700 { color: #c9d1d9; }
        html.light .text-gray-900 { color: #24292f; }
        html.dark .text-gray-900 { color: #c9d1d9; }
        html.light .border-gray-200 { border-color: #d0d7de; }
        html.dark .border-gray-200 { border-color: #30363d; }
        html.light .hover\:bg-gray-50:hover { background-color: #f6f8fa; }
        html.dark .hover\:bg-gray-50:hover { background-color: #21262d; }

        /* Link hover effects */
        html.light a:hover { color: #0969da; }
        html.dark a:hover { color: #1f6feb; }

        html.dark pre { background: #161b22 !important; }
        html.dark pre code { color: #c9d1d9; background: transparent !important; }
        html.dark .hljs { background: #161b22 !important; color: #c9d1d9; }
        html.dark .hljs-keyword { color: #ff7b72; }
        html.dark .hljs-string { color: #a5d6ff; }
        html.dark .hljs-number { color: #79c0ff; }
        html.dark .hljs-comment { color: #8b949e; }
        html.dark .hljs-function { color: #d2a8ff; }
        html.dark .hljs-variable { color: #ffa657; }
    </style>
<script>
        const getSystemPreference = () => window.matchMedia('(prefers-color-scheme: dark)').matches;
        const applyTheme = () => {
            const theme = localStorage.theme ?? 'system';
            const isDark = theme === 'system' ? getSystemPreference() : theme === 'dark';
            document.documentElement.classList.toggle('light', !isDark);
            document.documentElement.classList.toggle('dark', isDark);
        };
        document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', applyTheme) : applyTheme();
        hljs.highlightAll();
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J8N1Q1GVVB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J8N1Q1GVVB');
</script>
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105986243', 'ym');
    ym(105986243, 'init', {ssr:true, webvisor:true, clickmap:true, accurateTrackBounce:true, trackLinks:true});
</script>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <nav class="mb-6">
            <a href="/legacy/fortran/fortran.html" class="inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Fortran Programs
            </a>
        </nav>
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Read and Sort <span class="text-xl font-normal text-gray-600">(2002)</span></h1>
        <p class="text-gray-600 mb-6">A Fortran program that reads real numbers from a text file, calculates statistical measures (mean value and dispersion), and sorts the data using quicksort algorithm. The program demonstrates dynamic memory allocation, file I/O operations, recursive sorting algorithms, and statistical calculations. Includes multiple quicksort implementations (QSort, QSort2, QSort3) showing different approaches to the same problem.</p>
        <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
            <h2 class="font-semibold text-gray-900 mb-4">Source Code:</h2>
            <pre><code class="language-fortran">program ReadNsort

real, allocatable :: values(:)
real :: t
integer :: n, len = 0
character(20) :: infile /'test.txt'/, outfile /'out.txt'/

open(unit=1, file=infile)

print *, 'Opening file ', infile, '..'
print *, 'Scaning file...'
do
	read(unit=1, fmt=*, end=1) t
	len = len + 1
enddo

1 continue
2 format(F7.5)

print *, 'Size is ', len, ' records...'

allocate (values(len))

rewind 1

print *, 'Reading file...'

read (1,*) (values(n), n=1,len)
print *, 'Done!..'

close (1)

call Dispersion(values, t)
print *, 'Dispersion is:', t

call MeanVal(values, t)
print *, 'Mean value is:', t

print *, 'Sorting with QSort...'
call QSort3(values)
print *, 'Done!..'

print *, 'Now writing ', outfile, '..'

open(unit=1, file=outfile)
write (unit=1, fmt=2) (values(n), n=1,len)

print *, 'Done!..'



!open(unit=3, file=infile)
!do n=1,1000000
!call random_number(t)
!write (unit=1, fmt=2) t
!enddo
!close (1)


close (1)

contains

subroutine MeanVal(values, mean)
real :: mean
real :: values(:)
integer :: n

mean = 0

do n = lbound(values,1), ubound(values,1)
	mean = mean + values(n)
enddo

mean = mean / n

end subroutine

subroutine Dispersion(values, disp)
real :: disp, mean
real :: values(:)
integer :: n

disp = 0

call MeanVal(values, mean)

do n = lbound(values,1), ubound(values,1)
	disp = values(n)*values(n)
enddo

disp = (n*disp - mean*mean)/(n*(n-1))

end subroutine



recursive subroutine QSort(values, lb, ub)
real, intent(inout) :: values(:)
integer :: median, lb, ub, ucntr, lcntr

median = (ub + lb)/2

ucntr = ub
lcntr = lb

do
	if (values(lcntr) > values(median) .and. median > lcntr) then
		call cycler(values(lcntr), values(median - 1), values(median))
		median = median - 1
	else if (values(lcntr) <= values(median) .and. median > lcntr) then 
		lcntr = lcntr + 1
	endif
		
	if (values(ucntr) <= values(median) .and. median < ucntr) then
		call cycler(values(ucntr), values(median + 1), values(median))
		median = median + 1
	else if (values(ucntr) >= values(median) .and. median < ucntr) then 
		ucntr = ucntr - 1
	endif
	if (lcntr >= ucntr) exit
enddo

if (median - lb > 4) call QSort(values, lb, median)
if (ub - median > 4) call QSort(values, median, ub)

end subroutine


recursive subroutine QSort2(values)
real :: values(:)
real :: median
integer :: lb, ub, ucntr, lcntr

ub = ubound(values,1)
lb = lbound(values,1)

median = .5

ucntr = ub
lcntr = lb

do
	if (values(lcntr) > median) then
		call cycler(values(lcntr), values((lcntr + ucntr)/2), values((lcntr + ucntr)/2))
	else
		lcntr = lcntr + 1
	endif
		
	if (values(ucntr) <= median) then
		call cycler(values(ucntr), values((lcntr + ucntr)/2), values((lcntr + ucntr)/2))
	else
		ucntr = ucntr - 1
	endif
	if (lcntr >= ucntr) exit
enddo

if (lcntr - lb > 1) call QSort2(values(lb:lcntr))
if (ub - ucntr > 1) call QSort2(values(ucntr:ub))

end subroutine

recursive subroutine QSort3(values)
real, intent(inout) :: values(:)
integer :: median, lb, ub, ucntr, lcntr

ub = ubound(values,1)
lb = lbound(values,1)

median = (ub + lb)/2

ucntr = ub
lcntr = lb

do
	if (values(lcntr) > values(median) .and. median > lcntr) then
		call cycler(values(lcntr), values(median - 1), values(median))
		median = median - 1
	else if (values(lcntr) <= values(median) .and. median > lcntr) then 
		lcntr = lcntr + 1
	endif
		
	if (values(ucntr) < values(median) .and. median < ucntr) then
		call cycler(values(ucntr), values(median + 1), values(median))
		median = median + 1
	else if (values(ucntr) >= values(median) .and. median < ucntr) then 
		ucntr = ucntr - 1
	endif
	if (lcntr >= ucntr) exit
enddo

if (median - lb > 6) call QSort3(values(lb:median))
if (ub - median > 6) call QSort3(values(median:ub))

end subroutine

subroutine cycler(a, b, c)
real a,b,c,t
t = a; a = b; b = c; c = t
end subroutine

end</code></pre>
        </div>
    </div>
</body>
</html>
