<!DOCTYPE html>
<html lang="en" class="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Make Album - Perl Utilities</title>
<meta name="description" content="Make Album - Perl utility by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta name="keywords" content="Kirill Arkhipenko, Кирилл Архипенко, kusaku, retrewert, aks1983, legacy">
<meta name="author" content="Kirill Arkhipenko">
<link rel="canonical" href="https://kusaku.su/legacy/perl/make-album.html">
<link rel="alternate" hreflang="en" href="https://kusaku.su/legacy/perl/make-album.html">
<link rel="alternate" hreflang="ru" href="https://kusaku.su/legacy/perl/make-album.html">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<meta name="robots" content="index, follow">
<meta property="og:title" content="Make Album - Perl Utilities">
<meta property="og:description" content="Make Album - Perl utility by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta property="og:url" content="https://kusaku.su/legacy/perl/make-album.html">
<meta property="og:type" content="website">
<meta property="og:site_name" content="kusaku.su">
<meta property="og:image" content="https://kusaku.su/avatar.webp">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Make Album - Perl Utilities">
<meta name="twitter:description" content="Make Album - Perl utility by Kirill Arkhipenko (kusaku, retrewert, aks1983).">
<meta name="twitter:image" content="https://kusaku.su/avatar.webp">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<style>
        html.light body { background: #ffffff; color: #24292f; }
        html.dark body { background: #0d1117; color: #c9d1d9; }
        html.light .bg-white { background-color: #ffffff; }
        html.dark .bg-white { background-color: #161b22; }
        html.light .text-gray-600 { color: #57606a; }
        html.dark .text-gray-600 { color: #8b949e; }
        html.light .text-gray-700 { color: #24292f; }
        html.dark .text-gray-700 { color: #c9d1d9; }
        html.light .text-gray-900 { color: #24292f; }
        html.dark .text-gray-900 { color: #c9d1d9; }
        html.light .border-gray-200 { border-color: #d0d7de; }
        html.dark .border-gray-200 { border-color: #30363d; }
        html.light .hover\:bg-gray-50:hover { background-color: #f6f8fa; }
        html.dark .hover\:bg-gray-50:hover { background-color: #21262d; }
        
        /* Link hover effects */
        html.light a:hover { color: #0969da; }
        html.dark a:hover { color: #1f6feb; }
        
        html.dark pre { background: #161b22 !important; }
        html.dark pre code { color: #c9d1d9; background: transparent !important; }
        html.dark .hljs { background: #161b22 !important; color: #c9d1d9; }
        html.dark .hljs-keyword { color: #ff7b72; }
        html.dark .hljs-string { color: #a5d6ff; }
        html.dark .hljs-comment { color: #8b949e; }
    </style>
<script>
        const getSystemPreference = () => window.matchMedia('(prefers-color-scheme: dark)').matches;
        const applyTheme = () => {
            const theme = localStorage.theme ?? 'system';
            const isDark = theme === 'system' ? getSystemPreference() : theme === 'dark';
            document.documentElement.classList.toggle('light', !isDark);
            document.documentElement.classList.toggle('dark', isDark);
        };
        document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', applyTheme) : applyTheme();
        hljs.highlightAll();
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J8N1Q1GVVB"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J8N1Q1GVVB');
</script>
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105986243', 'ym');
    ym(105986243, 'init', {ssr:true, webvisor:true, clickmap:true, accurateTrackBounce:true, trackLinks:true});
</script>
</head>
<body class="min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <nav class="mb-6">
            <a href="/legacy/perl/perl.html" class="inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to Perl Projects
            </a>
        </nav>
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Make Album <span class="text-xl font-normal text-gray-600">(2007)</span></h1>
        <p class="text-gray-600 mb-6">Creates an HTML image catalog/gallery from image files. Recursively finds images (PCX, BMP, GIF, JPG, JPEG, PSD, TIF, TIFF), generates thumbnails using alchlong.exe, and creates an organized HTML index with image thumbnails, file sizes, and directory structure. Includes progress tracking and time estimation. Created for ReklamaFactor in 2007.</p>
        <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
            <h2 class="font-semibold text-gray-900 mb-4">Usage:</h2>
            <pre class="bg-gray-100 dark:bg-gray-800 p-4 rounded"><code class="language-bash">perl makealbum.pl &lt;input_directory&gt; &lt;output_directory&gt;</code></pre>
            <p class="text-sm text-gray-600 mt-2">Scans input directory for images, generates thumbnails, and creates an HTML catalog in the output directory.</p>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
            <h2 class="font-semibold text-gray-900 mb-4">Source Code:</h2>
            <pre><code class="language-perl">#!/usr/bin/perl
#

sub tree {
	my(@filenames);
	local (*ROOT);
	my($root) = $_[0];
	opendir ROOT, $root;
	my(@filelist) = readdir ROOT;
	closedir ROOT;
	foreach $name (@filelist) {
		if ($name ne &#x27;.&#x27; and $name ne &#x27;..&#x27;) { 
			$name = $root . &quot;\\&quot; . $name;
			if (-f $name &amp;&amp; ($name =~ /.pcx$|.bmp$|.gif$|.jpg$|.jpeg$|.psd$|.tif$|.tiff$/i)) {
				$name =~ s/\\\\/\\/;
				@filenames = (@filenames, $name);
				$filesizes{$name} = (stat($name))[7];
				$sizea += $filesizes{$name};
				$i++;
			}
			@filenames = (@filenames, tree($name)) if (-d $name); 
		}
	}
	print &quot;$i images ($sizea bytes): $root\n&quot;;
	return @filenames;
}

$outdir = $ARGV[1] or die &quot;outdir fail...&quot;;

@filenames = tree($ARGV[0]) or die &quot;indir fail...&quot;;;

system(&quot;md \&quot;$outdir\&quot;&quot;) if (!-d $outdir);
open(CATALOG, &quot;&gt;$outdir\\index.html&quot;) or die &quot;index fail...&quot;;

print CATALOG &lt;&lt;EOF;

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=windows-1251&quot; /&gt;
&lt;title&gt;ReklamaFactor image catalog [$ARGV[0]]&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
&lt;!--
body,td,th {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10pt;
	color: #666666;
}
td {
	background-color: #CCCCCC;
	font-size: 8pt;
}
th {
	font-family: Arial, Helvetica, sans-serif;
	font-size: 10pt;
	color: #FFFFFF;
	background-color: #224488;
}
a:link {
	color: #0099FF;
}
a:visited {
	color: #990033;
}
a:hover {
	color: #FF0000;
}
a:active {
	color: #0000FF;
}
--&gt;
&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;table width=&quot;100%&quot; border=&quot;0&quot; align=&quot;center&quot; cellpadding=&quot;5&quot; cellspacing=&quot;3&quot;&gt;
EOF

$t1 = time;

foreach $filename (@filenames) {
	($name, @path) = reverse(split(/\\/, $filename));
	($drive, @outpath) = reverse(@path);
	$outpath = join(&quot;\\&quot;, @outpath);
	if ($lastoutpath ne $outpath) {
		if ($n%4 != 0){
			while ($n%4 != 0) {
				print CATALOG &quot;&lt;td&gt;&amp;nbsp;&lt;/td&gt;\n&quot;;
				$n++;
			}
			print CATALOG &quot;&lt;/tr&gt;\n&quot;;
			
		}
		print CATALOG &quot;&lt;tr&gt;&lt;th colspan=4 align=center&gt;$drive\\$outpath&lt;/th&gt;&lt;/tr&gt;\n&quot;;
		$lastoutpath = $outpath;
	}

	system(&quot;md \&quot;$outdir\\$outpath\&quot;&quot;) if (!-d &quot;$outdir\\$outpath&quot;);
	system(&quot;alchlong.exe \&quot;$filename\&quot; \&quot;$outdir\\$outpath\\$name.jpg\&quot; -Xd200 -Yd200 -+ -jh&quot;) if (!-f &quot;$outdir\\$outpath\\$name.jpg&quot;);
	print CATALOG &quot;&lt;tr&gt;\n&quot; if ($n%4 == 0);
	print CATALOG &quot;&lt;td align=center&gt;&lt;a href=\&quot;$filename\&quot;&gt;&lt;image border=0 src=&#x27;$outpath\\$name.jpg&#x27; alt=&#x27;$name.jpg&#x27;&gt;&lt;/a&gt;&lt;br&gt;\n&quot;;
	print CATALOG &quot;&lt;a href=\&quot;$filename\&quot;&gt;$name ($filesizes{$filename} bytes)&lt;/a&gt;&lt;/td&gt;\n&quot;;
	print CATALOG &quot;&lt;/tr&gt;\n&quot; if (($n+1)%4 == 0);

	$n++;
	$i--;

	$sizea -= $filesizes{$filename};
	$sizeb += $filesizes{$filename};

	$tl =  (time - $t1) * ($sizea / $sizeb + $i / $n) / 2;

	($tlt{&#x27;h&#x27;}) = split(/\./, ($tl/3600)%24);
	($tlt{&#x27;m&#x27;}) = split(/\./, ($tl/60)%60);
	($tlt{&#x27;s&#x27;}) = split(/\./, ($tl/1)%60);

	print &quot;$i images ($sizea bytes and $tlt{&#x27;h&#x27;}:$tlt{&#x27;m&#x27;}:$tlt{&#x27;s&#x27;}) left...\n&quot;;
}

if ($n%4 != 0){
	while ($n%4 != 0) {
		print CATALOG &quot;&lt;td&gt;&amp;nbsp;&lt;/td&gt;\n&quot;;
		$n++;
	}
}

print CATALOG &lt;&lt;EOF;
&lt;/table&gt;
&lt;p align=&quot;center&quot;&gt;&amp;copy; ReklamaFactor 2007&lt;br&gt;&amp;copy; &lt;a href=&quot;https://kusaku.su/&quot; title=&quot;made by kusaku&quot; target=&quot;_blank&quot;&gt;kusaku&lt;/a&gt; 2007&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF
</code></pre>
        </div>
    </div>
</body>
</html>
